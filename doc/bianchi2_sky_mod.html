<HTML>
<HEAD>
   <TITLE> module bianchi2_sky_mod (generated by f90doc) </TITLE>
  <LINK rel="stylesheet" href="stylesheet.css" type="text/css" /> </HEAD>
<H1> Module bianchi2_sky_mod </H1>
<PRE>module bianchi2_sky_mod

        ! Uses
    use <A HREF="s2_types_mod.html">s2_types_mod</A>
    use <A HREF="s2_sky_mod.html">s2_sky_mod</A>
    use <A HREF="s2_error_mod.html">s2_error_mod</A>
    use <A HREF="bianchi2_error_mod.html">bianchi2_error_mod</A>

        ! Types
    public type <A HREF="bianchi2_sky_mod.html#type_bianchi2_sky">bianchi2_sky</A>

        ! Variables
    real (kind=s2_dp), private, parameter :: <A HREF="bianchi2_sky_mod.html#var_bianchi2_cmb_t">BIANCHI2_CMB_T</A> = 1d0

        ! Subroutines and functions
    public function <A HREF="bianchi2_sky_mod.html#function_bianchi2_sky_init">bianchi2_sky_init</A> (omega_matter_in, omega_lambda_in, h, zE_in, wH, rhand, nside) result (b)
    public subroutine <A HREF="bianchi2_sky_mod.html#subroutine_bianchi2_sky_free">bianchi2_sky_free</A> (b)
    public subroutine <A HREF="bianchi2_sky_mod.html#subroutine_bianchi2_sky_param_write">bianchi2_sky_param_write</A> (b)
    public subroutine <A HREF="bianchi2_sky_mod.html#subroutine_bianchi2_sky_compute_map">bianchi2_sky_compute_map</A> (b, nside)
    public subroutine <A HREF="bianchi2_sky_mod.html#subroutine_bianchi2_sky_compute_alm">bianchi2_sky_compute_alm</A> (b, lmax, mmax)
    public function <A HREF="bianchi2_sky_mod.html#function_bianchi2_sky_get_sky">bianchi2_sky_get_sky</A> (b) result (sky)
    public subroutine <A HREF="bianchi2_sky_mod.html#subroutine_bianchi2_sky_get_alm">bianchi2_sky_get_alm</A> (b, alm)
    public subroutine <A HREF="bianchi2_sky_mod.html#subroutine_bianchi2_sky_apply_beam">bianchi2_sky_apply_beam</A> (b, fwhm, lmax)
    public subroutine <A HREF="bianchi2_sky_mod.html#subroutine_bianchi2_sky_write">bianchi2_sky_write</A> (b, filename, file_type, comment)
    public subroutine <A HREF="bianchi2_sky_mod.html#subroutine_bianchi2_sky_rotate">bianchi2_sky_rotate</A> (b, alpha, beta, gamma)
    private subroutine <A HREF="bianchi2_sky_mod.html#subroutine_get_results">get_results</A> (tstop_use, R_final, RH_final, cos_bit_final, sin_bit_final)
    private subroutine <A HREF="bianchi2_sky_mod.html#subroutine_fcn">fcn</A> (t, vars, ff)
    private subroutine <A HREF="bianchi2_sky_mod.html#subroutine_out">out</A> (t, vals)
    private subroutine <A HREF="bianchi2_sky_mod.html#subroutine_get_tau">get_tau</A> (tau_needed)
    private function <A HREF="bianchi2_sky_mod.html#function_f1r">F1r</A> (a)

end module bianchi2_sky_mod
</PRE>
 Provides functionality to simulate a Bianchi2 VII_h model of the CMB, 
 incorporating a cosmological constant.
 Uses the s2_sky module to create healpix sky maps.
<P>
<STRONG>Author:</STRONG> A. N. Lasenby & J. D. McEwen (mcewen@mrao.cam.ac.uk)
<P>
<STRONG>Version:</STRONG> 0.1 October 2005

<HR><H2> Description of Types </H2>
<A NAME="type_bianchi2_sky"><H3>bianchi2_sky</H3></A>
<PRE>public type bianchi2_sky
    private
    logical :: init = .false.
    real (kind=s2_dp) :: omega_matter = 0.0d0
    real (kind=s2_dp) :: omega_lambda = 0.0d0
    real (kind=s2_dp) :: h = 0.0d0
    real (kind=s2_dp) :: zE = 0.0d0
    real (kind=s2_dp) :: wH = 0.0d0
    logical :: rhand = .true.
    type (s2_sky) :: sky
end type bianchi2_sky
</PRE>
 <UL>
 <LI>  init: Initialisation status.
 <LI>  omega_matter: Matter density (input parameter).
 <LI>  omega_lambda: Lambda density (input parameter).
 <LI>  h: Bianchi h parameter that controls `spiralness' (related to 
   characteristic wavelength over which basis vectors change 
   orientation) (input parameter).
 <LI>  zE: Red shift (input parameter).
 <LI>  wH: Normalised vorticity (normalised to Hubble constant) (input 
   parameter).
 <LI>  rhand: Logical specifying handedness of map (true=right).
 <LI>  sky: Simulated map.
 </UL>

<HR><H2> Description of Variables </H2>
<A NAME="var_bianchi2_cmb_t"><H3>BIANCHI2_CMB_T</H3></A>
<PRE>real (kind=s2_dp), private, parameter :: BIANCHI2_CMB_T = 1d0
</PRE>

<HR><H2> Description of Subroutines and Functions </H2>
<A NAME="function_bianchi2_sky_init"><H3>bianchi2_sky_init</H3></A>
<PRE>public function bianchi2_sky_init (omega_matter_in, omega_lambda_in, h, zE_in, wH, rhand, nside) result (b)
    real (kind=s2_dp), intent(in) :: omega_matter_in
    real (kind=s2_dp), intent(in) :: omega_lambda_in
    real (kind=s2_dp), intent(in) :: h
    real (kind=s2_dp), intent(in) :: zE_in
    real (kind=s2_dp), intent(in) :: wH
    logical, intent(in) :: rhand
    integer, intent(in) :: nside
    type (bianchi2_sky) :: b
    ! Calls: bianchi2_error, get_results, get_tau, in_ring, pix2ang_ring
end function bianchi2_sky_init
</PRE>
 Initialise bianchi2 object by performing a bianchi2 simulation that
 incorporates a cosmological constant.
<P>
 Variables:
  <UL>
  <LI>  omega_matter_in: Input omega_matter parameter (see bianchi2 data
    type for explanation).
  <LI>  omega_lambda_in: Input omega_lambda parameter (see bianchi2 data
    type for explanation).
  <LI>  h: Input h parameter (see bianchi2 data type for explanation).
  <LI>  zE_in: Input zE parameter (see bianchi2 data type for explanation).
  <LI>  wH: Input wH parameter (see bianchi2 data type for explanation).
  <LI>  rhand: Logical to specify handedness of map.
  <LI>  nside: Nside of Healpix map to generate.
  <LI>  b: Initialised bianchi2 object with simulated map calculated.
  </UL>
<P>
<STRONG>Author:</STRONG> A.N. Lasenby and J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="subroutine_bianchi2_sky_free"><H3>bianchi2_sky_free</H3></A>
<PRE>public subroutine bianchi2_sky_free (b)
    type (bianchi2_sky), intent(inout) :: b
    ! Calls: bianchi2_error, s2_sky_free
end subroutine bianchi2_sky_free
</PRE>
 Free all memory associated with a bianchi2 object.
<P>
 Variables:
  <UL>
  <LI>  b: Bianchi2 object to free.
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="subroutine_bianchi2_sky_param_write"><H3>bianchi2_sky_param_write</H3></A>
<PRE>public subroutine bianchi2_sky_param_write (b)
    type (bianchi2_sky), intent(in) :: b
end subroutine bianchi2_sky_param_write
</PRE>
 Write parameters of the Bianchi2 simulation to standard output.
<P>
 Variables:
  <UL>
  <LI>  b: Bianchi2 object containing parameter attributes to write.
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="subroutine_bianchi2_sky_compute_map"><H3>bianchi2_sky_compute_map</H3></A>
<PRE>public subroutine bianchi2_sky_compute_map (b, nside)
    type (bianchi2_sky), intent(inout) :: b
    integer, intent(in) :: nside
    ! Calls: bianchi2_error, s2_sky_compute_map
end subroutine bianchi2_sky_compute_map
</PRE>
 Compute the map of the bianchi2 sky, assuming the alms are already
 defined.
<P>
 Variables:
  <UL>
  <LI>  b: Bianchi2 object containing alms to compute map of.
  <LI>  nside: Healpix nside to compute map at.
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="subroutine_bianchi2_sky_compute_alm"><H3>bianchi2_sky_compute_alm</H3></A>
<PRE>public subroutine bianchi2_sky_compute_alm (b, lmax, mmax)
    type (bianchi2_sky), intent(inout) :: b
    integer, intent(in) :: lmax
    integer, intent(in) :: mmax
    ! Calls: bianchi2_error, s2_sky_compute_alm
end subroutine bianchi2_sky_compute_alm
</PRE>
 Compute the alm of the bianchi2 sky, assuming the map is already
 defined.
<P>
 Variables:
  <UL>
  <LI>  b: Bianchi2 object containing sky to compute alms of.
  <LI>  lmax: Maximum harmonic l to consider when computing alms.
  <LI>  mmax: Maximum harmonic m to consider when computing alms.
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="function_bianchi2_sky_get_sky"><H3>bianchi2_sky_get_sky</H3></A>
<PRE>public function bianchi2_sky_get_sky (b) result (sky)
    type (bianchi2_sky), intent(in) :: b
    type (s2_sky) :: sky
    ! Calls: s2_error
end function bianchi2_sky_get_sky
</PRE>
 Get sky variable from the passed bianchi2 object.
<P>
 Notes:
   <UL>
   <LI>  Initialises a new sky as a copy of the bianchi2 sky.
   <LI>  The returned sky is subsequently independed of the sky stored
     herein and should be freed by the calling routine at some point.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  b: Bianchi2 object containing sky to get.
   <LI>  sky: Object sky variable returned.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="subroutine_bianchi2_sky_get_alm"><H3>bianchi2_sky_get_alm</H3></A>
<PRE>public subroutine bianchi2_sky_get_alm (b, alm)
    type (bianchi2_sky), intent(in) :: b
    complex (kind=s2_spc), intent(out), dimension (:,:) :: alm
    ! Calls: bianchi2_error, s2_sky_get_alm
end subroutine bianchi2_sky_get_alm
</PRE>
 Get alms contained in a bianchi2 sky object.  Alms must already be
 computed.
<P>
 Notes:
   <UL>
   <LI>  Error occurs if alms are not already computed.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  b: Bianchi2 object containing sky that in turn contained the alms
     to get.
   <LI>  alm: Alms of simulated bianchi map extracted.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="subroutine_bianchi2_sky_apply_beam"><H3>bianchi2_sky_apply_beam</H3></A>
<PRE>public subroutine bianchi2_sky_apply_beam (b, fwhm, lmax)
    type (bianchi2_sky), intent(inout) :: b
    real (kind=s2_sp), intent(in) :: fwhm
    integer, intent(in) :: lmax
    ! Calls: s2_pl_free, s2_sky_conv
end subroutine bianchi2_sky_apply_beam
</PRE>
 Apply Gaussian beam with specified FWHM.  (FWHM must be passed in
 arcmin.)
<P>
 Notes:
   <UL>
   <LI>  Error occurs if alms are not already computed.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  b: Bianchi2 object containing sky that is to be comvolved with
     the beam.
   <LI>  fwhm: Gaussian beam FWHM to use (specified in arcmin).
   <LI>  lmax: Maximum harmonic l to consider.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="subroutine_bianchi2_sky_write"><H3>bianchi2_sky_write</H3></A>
<PRE>public subroutine bianchi2_sky_write (b, filename, file_type, comment)
    type (bianchi2_sky), intent(inout) :: b
    character (len=*), intent(in) :: filename
    integer, intent(in) :: file_type
    character (len=*), optional, intent(in) :: comment
    ! Calls: bianchi2_error, s2_error, s2_sky_io_fits_write, s2_sky_write_map_file
end subroutine bianchi2_sky_write
</PRE>
 Write the bianchi2 simulated sky to a file. 
<P>
 Variables:
  <UL>
  <LI>  b: Bianchi2 object to save sky of.
  <LI>  filename: Name of output file.
  <LI>  file_type: Type of output file, either fits map or sky file 
    (see s2_sky_mod for more details).  Integer flag that may be 
    either S2_SKY_FILE_TYPE_MAP or S2_SKY_FILE_TYPE_SKY.
  <LI>  [comment]: Optional comment to append to file header.
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="subroutine_bianchi2_sky_rotate"><H3>bianchi2_sky_rotate</H3></A>
<PRE>public subroutine bianchi2_sky_rotate (b, alpha, beta, gamma)
    type (bianchi2_sky), intent(inout) :: b
    real (kind=s2_sp) :: alpha
    real (kind=s2_sp) :: beta
    real (kind=s2_sp) :: gamma
    ! Calls: bianchi2_error, s2_sky_rotate
end subroutine bianchi2_sky_rotate
</PRE>
 Rotate the simulated sky of the bianchi2 object.  
<P>
 Variables:
  <UL>
  <LI>  b: Bianchi2 object containing sky to be rotated.
  <LI>  alpha: Alpha Euler angle of the rotation.
  <LI>  beta: Beta Euler angle of the rotation.
  <LI>  gamma: Gamma Euler angle of the rotation.
  </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> 0.1 October 2005
<A NAME="subroutine_get_results"><H3>get_results</H3></A>
<PRE>private subroutine get_results (tstop_use, R_final, RH_final, cos_bit_final, sin_bit_final)
    real (kind=s2_dp), intent(in) :: tstop_use
    real (kind=s2_dp), intent(out) :: R_final
    real (kind=s2_dp), intent(out) :: RH_final
    real (kind=s2_dp), intent(out) :: cos_bit_final
    real (kind=s2_dp), intent(out) :: sin_bit_final
    ! Calls: bianchi2_error, d02cjf
end subroutine get_results
</PRE>
 This returns the values found at the end of the integral
<P>
<STRONG>Author:</STRONG> A. N. Lasenby
<P>
<STRONG>Version:</STRONG> 08/10/05
<A NAME="subroutine_fcn"><H3>fcn</H3></A>
<PRE>private subroutine fcn (t, vars, ff)
    real (kind=s2_dp), intent(in) :: t
    real (kind=s2_dp), intent(in), dimension (nvars) :: vars
    real (kind=s2_dp), intent(out), dimension (nvars) :: ff
end subroutine fcn
</PRE>
<STRONG>Author:</STRONG> A. N. Lasenby
<P>
<STRONG>Version:</STRONG> 08/10/05
<A NAME="subroutine_out"><H3>out</H3></A>
<PRE>private subroutine out (t, vals)
    real (kind=s2_dp), intent(inout) :: t
    real (kind=s2_dp), intent(in), dimension (b2gd_nvars) :: vals
    ! Calls: fcn
end subroutine out
</PRE>
<STRONG>Author:</STRONG> A. N. Lasenby
<P>
<STRONG>Version:</STRONG> 08/10/05
<A NAME="subroutine_get_tau"><H3>get_tau</H3></A>
<PRE>private subroutine get_tau (tau_needed)
    real (kind=s2_dp), intent(out) :: tau_needed
    ! Calls: d01ajf
end subroutine get_tau
</PRE>
<STRONG>Author:</STRONG> A. N. Lasenby
<P>
<STRONG>Version:</STRONG> 08/10/05
<A NAME="function_f1r"><H3>F1r</H3></A>
<PRE>private function F1r (a)
    real (kind=s2_dp), intent(in) :: a
    real (kind=s2_dp) :: F1r
end function F1r
</PRE>
<STRONG>Author:</STRONG> A. N. Lasenby
<P>
<STRONG>Version:</STRONG> 08/10/05
</HTML>
